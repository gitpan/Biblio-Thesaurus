#!/usr/bin/perl -s

our ($dir);
$dir ||= ".";

my $thesaurus= shift or die("Usage: $0 [-dir=...] thesarus\n");
mkdir($dir) unless -d $dir;

use Biblio::Thesaurus;
use CGI qw(:all :nodebug);

my $obj = thesaurusLoad($thesaurus);
open (G,">$dir/0_lista_de_termos.html") or die("cant create index");

print G $obj->downtr(
     {-default  => sub { 
          my $cla=(exists $obj->{languages}{$rel})?"lingua":"rel";
          if(@terms > 1){
             li({-class=>$cla},strong($obj->getDescription($rel)),"\t".
               ul(li([map{ a({href=>t2f($_)},$_)."\n"} sort @terms])))."\n"}
          else{
             li({-class=>$cla},strong($obj->getDescription($rel)),"\t".
               join(", ", map{ a({href=>t2f($_)},$_)."\n"} sort @terms))."\n"}
          },
      -order    => ["PT","FR",'SP','ES' , 'EN',"DE" ,"BT","NT","RT","MT","UF","USE","SN"],
      -end      => sub { "Thesaurus<small>:\n $_ \nFIM\n"},
      -eachTerm => sub {
          my $tt=t2f($term);
          open(F,">$dir/$tt") or die ("cant create file $dir/$tt\n");
          print F ambsheader($term);
          print F h3($term).ul($_)."\n";
          print F ambsfooter();
          close F;
          print STDERR "$term\n";
          li(a({href=>$tt},$term ));
        },
      SN => sub{ li({-class=>"text"},strong("sn"),join("",@terms)) },
     });
close G;

sub t2f{
 my $a = shift;
 ### for ($a){ tr/ביםףתאטלעשגךמפהכןצדץסח/aeiouaeiouaeiouaeiouaonc/; }
 for ($a){ tr/ביםףתאטלעשגךמפהכןצדץסח/AEIOUAEIOUAEIOUAEIOUAONC/;
           s/[ \(\)\/\?\":]/_/g }
 "$a.html"
}

sub ambsheader{
 my $t=shift;
 return qq{<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>$t</title>
  <link href="http://eremita.di.uminho.pt/~ambs/style.css" rel="stylesheet"
type="text/css"/>
 </head>
 <body>
};
}

sub ambsfooter{
 return qq{
  </body>
</html>
}
}


__END__
<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>NumExp</title>
  <link href="http://eremita.di.uminho.pt/~ambs/style.css" rel="stylesheet"
type="text/css"/>
 </head>
 <body>

<!-- CONTENTS -->

